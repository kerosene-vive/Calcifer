var t="undefined"!=typeof self?self:{};function e(e,n){t:{for(var r=["CLOSURE_FLAGS"],i=t,o=0;o<r.length;o++)if(null==(i=i[r[o]])){r=null;break t}r=i}return null!=(e=r&&r[e])?e:n}let n;const r="undefined"!=typeof TextEncoder;function i(t){if(r)t=(n||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(e<128)r[n++]=e;else{if(e<2048)r[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&i<t.length){const o=t.charCodeAt(++i);if(o>=56320&&o<=57343){e=1024*(e-55296)+o-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var o,s=e(610401301,!1),a=e(653718497,e(1,!0));const u=t.navigator;function c(t){return!!s&&(!!o&&o.brands.some((({brand:e})=>e&&-1!=e.indexOf(t))))}function l(e){var n;return(n=t.navigator)&&(n=n.userAgent)||(n=""),-1!=n.indexOf(e)}function h(){return!!s&&(!!o&&o.brands.length>0)}function f(){return h()?c("Chromium"):(l("Chrome")||l("CriOS"))&&!(!h()&&l("Edge"))||l("Silk")}o=u&&u.userAgentData||null;var d=!h()&&(l("Trident")||l("MSIE"));!l("Android")||f(),f(),l("Safari")&&(f()||!h()&&l("Coast")||!h()&&l("Opera")||!h()&&l("Edge")||(h()?c("Microsoft Edge"):l("Edg/"))||h()&&c("Opera"));var p={},g=null;function m(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):-1!="=.".indexOf(t[e-1])&&(n=-1!="=.".indexOf(t[e-2])?n-2:n-1);var r=new Uint8Array(n),i=0;return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=g[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}_();for(var r=0;;){var i=n(-1),o=n(0),s=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|o>>4),64!=s&&(e(o<<4&240|s>>2),64!=a&&e(s<<6&192|a))}}(t,(function(t){r[i++]=t})),i!==n?r.subarray(0,i):r}function _(){if(!g){g={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;n<5;n++){var r=t.concat(e[n].split(""));p[n]=r;for(var i=0;i<r.length;i++){var o=r[i];void 0===g[o]&&(g[o]=i)}}}}var v="undefined"!=typeof Uint8Array,b=!d&&"function"==typeof btoa;function y(t){if(!b){var e;void 0===e&&(e=0),_(),e=p[e];var n=Array(Math.floor(t.length/3)),r=e[64]||"";let u=0,c=0;for(;u<t.length-2;u+=3){var i=t[u],o=t[u+1],s=t[u+2],a=e[i>>2];i=e[(3&i)<<4|o>>4],o=e[(15&o)<<2|s>>6],s=e[63&s],n[c++]=a+i+o+s}switch(a=0,s=r,t.length-u){case 2:s=e[(15&(a=t[u+1]))<<2]||r;case 1:t=t[u],n[c]=e[t>>2]+e[(3&t)<<4|a>>4]+s+r}return n.join("")}for(e="",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const w=/[-_.]/g,S={"-":"+",_:"/",".":"="};function A(t){return S[t]||""}function T(t){if(!b)return m(t);w.test(t)&&(t=t.replace(w,A)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function E(t){return v&&null!=t&&t instanceof Uint8Array}var I={};let P;function O(t){if(t!==I)throw Error("illegal external caller")}function L(){return P||=new N(null,I)}var N=class{constructor(t,e){if(O(e),this.i=t,null!=t&&0===t.length)throw Error("ByteString should be constructed with non-empty values")}};function U(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}let B;function x(){const e=Error();U(e,"incident"),function(e){t.setTimeout((()=>{throw e}),0)}(e)}function k(t){return U(t=Error(t),"warning"),t}function j(){return"function"==typeof BigInt}function F(t){return Array.prototype.slice.call(t)}var D="function"==typeof Symbol&&"symbol"==typeof Symbol();function M(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol()?Symbol():t}var V=M(),C=M("2ex"),R=M("1oa"),G=M("0dg"),z=D?(t,e)=>{t[V]|=e}:(t,e)=>{void 0!==t.s?t.s|=e:Object.defineProperties(t,{s:{value:e,configurable:!0,writable:!0,enumerable:!1}})},W=D?(t,e)=>{t[V]&=~e}:(t,e)=>{void 0!==t.s&&(t.s&=~e)},H=D?t=>0|t[V]:t=>0|t.s,$=D?t=>t[V]:t=>t.s,q=D?(t,e)=>{t[V]=e}:(t,e)=>{void 0!==t.s?t.s=e:Object.defineProperties(t,{s:{value:e,configurable:!0,writable:!0,enumerable:!1}})};function K(t,e){q(e,-30975&(0|t))}function Y(t,e){q(e,-30941&(34|t))}var J,X={},Z={};function Q(t){return!(!t||"object"!=typeof t||t.i!==Z)}function tt(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)&&t.constructor===Object}function et(t){return!(!Array.isArray(t)||t.length)&&!!(1&H(t))}const nt=[];function rt(t){if(2&t)throw Error()}q(nt,55),J=Object.freeze(nt);var it=Object.freeze({}),ot=Object.freeze({}),st=Object.freeze({});function at(t){return t.ba=!0,t}var ut=at((t=>"number"==typeof t)),ct=at((t=>"string"==typeof t)),lt=at((t=>"boolean"==typeof t)),ht="function"==typeof t.BigInt&&"bigint"==typeof t.BigInt(0),ft=at((t=>ht?t>=pt&&t<=mt:"-"===t[0]?_t(t,dt):_t(t,gt)));const dt=Number.MIN_SAFE_INTEGER.toString(),pt=ht?BigInt(Number.MIN_SAFE_INTEGER):void 0,gt=Number.MAX_SAFE_INTEGER.toString(),mt=ht?BigInt(Number.MAX_SAFE_INTEGER):void 0;function _t(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(r>i)return!1;if(r<i)return!0}}let vt,bt=0,yt=0;function wt(t){const e=t>>>0;bt=e,yt=(t-e)/4294967296>>>0}function St(t){if(t<0){wt(-t);const[e,n]=It(bt,yt);bt=e>>>0,yt=n>>>0}else wt(t)}function At(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else j()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+Tt(n)+Tt(t));return n}function Tt(t){return t=String(t),"0000000".slice(t.length)+t}function Et(t){if(t.length<16)St(Number(t));else if(j())t=BigInt(t),bt=Number(t&BigInt(4294967295))>>>0,yt=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+("-"===t[0]);yt=bt=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const e=Number(t.slice(r,i));yt*=1e6,bt=1e6*bt+e,bt>=4294967296&&(yt+=Math.trunc(bt/4294967296),yt>>>=0,bt>>>=0)}if(e){const[t,e]=It(bt,yt);bt=t,yt=e}}}function It(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}function Pt(t){if(null!=t&&"number"!=typeof t)throw Error(`Value of float/double field must be a number, found ${typeof t}: ${t}`);return t}function Ot(t){return null==t||"number"==typeof t?t:"NaN"===t||"Infinity"===t||"-Infinity"===t?Number(t):void 0}const Lt=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function Nt(t){const e=typeof t;switch(e){case"bigint":return!0;case"number":return Number.isFinite(t)}return"string"===e&&Lt.test(t)}function Ut(t){if("number"!=typeof t)throw k("int32");if(!Number.isFinite(t))throw k("int32");return 0|t}function Bt(t){return null==t?t:Ut(t)}function xt(t){if(null==t)return t;if("string"==typeof t){if(!t)return;t=+t}return"number"==typeof t&&Number.isFinite(t)?0|t:void 0}function kt(t){if(null!=t){if("number"!=typeof t)throw k("uint32");if(!Number.isFinite(t))throw k("uint32");t>>>=0}return t}function jt(t){return"-"!==t[0]&&(t.length<20||20===t.length&&Number(t.substring(0,6))<184467)}function Ft(t){if(null==t)return t;var e=typeof t;if("bigint"===e)return String(BigInt.asUintN(64,t));if(Nt(t)){if("string"===e)return e=Math.trunc(Number(t)),Number.isSafeInteger(e)&&e>=0?t=String(e):(-1!==(e=t.indexOf("."))&&(t=t.substring(0,e)),jt(t)||(Et(t),t=At(bt,yt))),t;if("number"===e)return(t=Math.trunc(t))>=0&&Number.isSafeInteger(t)?t:function(t){if(t<0){St(t);const e=At(bt,yt);return t=Number(e),Number.isSafeInteger(t)?t:e}return jt(String(t))?t:(St(t),4294967296*yt+(bt>>>0))}(t)}}function Dt(t){return null==t||"string"==typeof t?t:void 0}function Mt(t,e,n){if(null!=t&&"object"==typeof t&&t.L===X)return t;if(Array.isArray(t)){var r=H(t),i=r;return 0===i&&(i|=32&n),(i|=2&n)!==r&&q(t,i),new e(t)}}function Vt(t){if(void 0===Gt&&(Gt="function"==typeof Proxy?Xt(Proxy):null),!Gt||!Jt())return t;let e=Ct?.get(t);return e||(Math.random()>.01?t:(function(t){if(void 0===Wt){const t=new Gt([],{});Wt=1===Array.prototype.concat.call([],t).length}Wt&&"function"==typeof Symbol&&Symbol.isConcatSpreadable&&(t[Symbol.isConcatSpreadable]=!0)}(t),e=new Gt(t,{set:(t,e,n)=>(x(),t[e]=n,!0)}),function(t,e){(Ct||=new zt).set(t,e),(Rt||=new zt).set(e,t)}(t,e),e))}let Ct,Rt,Gt,zt,Wt,Ht,$t,qt,Kt,Yt;function Jt(){return void 0===zt&&(zt="function"==typeof WeakMap?Xt(WeakMap):null),zt}function Xt(t){try{return-1!==t.toString().indexOf("[native code]")?t:null}catch{return null}}function Zt(t,e,n){if(Jt()){if(Ht?.get(e)?.get(t)){if(n)return}else if(Math.random()>.01)return;var r=t.length;n={length:r};for(var i=0;i<Math.min(r,10);i++){if(r<=10)var o=i;else{o=r/10;const t=Math.floor(i*o);o=t+Math.floor(Math.random()*(Math.floor((i+1)*o)-t))}n[o]=t[o]}te(t,n)?((i=(r=Ht||=new zt).get(e))||(i=new zt,r.set(e,i)),i.set(t,n)):(x(),ne(t,e))}}function Qt(t,e){const n=Ht?.get(e)?.get(t);n&&!te(t,n)&&(x(),ne(t,e))}function te(t,e){if(t.length!==e.length)return!1;for(const i in e){var n,r=Number(i);if((n=Number.isInteger(r))&&(n=t[r],r=e[r],n=!(Number.isNaN(n)?Number.isNaN(r):n===r)),n)return!1}return!0}function ee(t){if(t&&Ht?.has(t)){var e=t.m;if(e)for(let n=0;n<e.length;n++){const r=e[n];if(n===e.length-1&&tt(r))for(const e in r){const n=r[e];Array.isArray(n)&&Qt(n,t)}else Array.isArray(r)&&Qt(r,t)}}}function ne(t,e){Ht?.get(e)?.delete(t)}function re(t,e,n){return t=ie(t,e[0],e[1],n?1:2),e!==qt&&n&&z(t,16384),t}function ie(t,e,n,r){if(r=r??0,null==t&&(t=$t),$t=void 0,null==t){var i=96;n?(t=[n],i|=512):t=[],e&&(i=-33521665&i|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(i=H(t)))throw Error("farr");if(64&i)return t;if(1===r||2===r||(i|=64),n&&(i|=512,n!==t[0]))throw Error("mid");t:{if(r=(n=t).length){const t=r-1;if(tt(n[t])){if((e=t-(+!!(512&(i|=256))-1))>=1024)throw Error("pvtlmt");i=-33521665&i|(1023&e)<<15;break t}}if(e){if((e=Math.max(e,r-(+!!(512&i)-1)))>1024)throw Error("spvt");i=-33521665&i|(1023&e)<<15}}}return q(t,i),t}function oe(t,e,n,r,i){if(null!=t){if(Array.isArray(t))t=et(t)?void 0:i&&2&H(t)?t:se(t,e,n,void 0!==r,i);else if(tt(t)){const o={};for(let s in t)o[s]=oe(t[s],e,n,r,i);t=o}else t=e(t,r);return t}}function se(t,e,n,r,i){const o=r||n?H(t):0;r=r?!!(32&o):void 0,t=F(t);for(let o=0;o<t.length;o++)t[o]=oe(t[o],e,n,r,i);return n&&n(o,t),t}function ae(t){return t.L===X?t.toJSON():function(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"bigint":return ft(t)?Number(t):String(t);case"boolean":return t?1:0;case"object":if(t)if(Array.isArray(t)){if(et(t))return}else{if(E(t))return y(t);if(t instanceof N){const e=t.i;return null==e?"":"string"==typeof e?e:t.i=y(e)}}}return t}(t)}function ue(t,e,n=Y){if(null!=t){if(v&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=H(t);return 2&r?t:(e&&=0===r||!!(32&r)&&!(64&r||!(16&r)),e?(q(t,-12293&(34|r)),t):se(t,ue,4&r?Y:n,!0,!0))}return t.L===X&&(n=t.m,t=2&(r=$(n))?t:ce(t,n,r,!0)),t}}function ce(t,e,n,r){return ee(t),t=t.constructor,$t=e=function(t,e,n){const r=n||2&e?Y:K,i=!!(32&e);return t=function(t,e,n){var r=(t=F(t)).length;const i=256&e?t[r-1]:void 0;for(r+=i?-1:0,e=512&e?1:0;e<r;e++)t[e]=n(t[e]);if(i){e=t[e]={};for(const t in i)e[t]=n(i[t])}return t}(t,e,(t=>ue(t,i,r))),z(t,32|(n?2:0)),t}(e,n,r),e=new t(e),$t=void 0,e}function le(t){const e=t.m,n=$(e);return 2&n?ce(t,e,n,!1):t}function he(t,e,n,r){return!(4&e)||null!=n&&(!r&&0===n&&(4096&e||8192&e)&&(t.constructor[G]=1+(0|t.constructor[G]))<5&&x(),0!==n&&!(n&e))}function fe(t,e){return pe(t=t.m,$(t),e)}function de(t,e,n,r){if(!((e=r+(+!!(512&e)-1))<0||e>=t.length||e>=n))return t[e]}function pe(t,e,n,r){if(-1===n)return null;const i=e>>15&1023||536870912;if(!(n>=i)){var o=t.length;return r&&256&e&&null!=(r=t[o-1][n])?(de(t,e,i,n)&&null!=C&&((e=(t=B??={})[C]||0)>=4||(t[C]=e+1,x())),r):de(t,e,i,n)}return 256&e?t[t.length-1][n]:void 0}function ge(t,e,n){const r=t.m;let i=$(r);return rt(i),me(r,i,e,n),t}function me(t,e,n,r){const i=e>>15&1023||536870912;if(n>=i){let o,s=e;if(256&e)o=t[t.length-1];else{if(null==r)return s;o=t[i+(+!!(512&e)-1)]={},s|=256}return o[n]=r,n<i&&(t[n+(+!!(512&e)-1)]=void 0),s!==e&&q(t,s),s}return t[n+(+!!(512&e)-1)]=r,256&e&&(n in(t=t[t.length-1])&&delete t[n]),e}function _e(t,e,n,r,i,o){const s=t.m;let a=$(s);r=2&a?1:r,o=!!o,i=ve(s,a,e,i);var u=H(i),c=i;if(Qt(c,t),2!==r&&1!==r||ne(c,t),he(t,u,void 0,o)){4&u&&(i=F(i),u=Ie(u,a),a=me(s,a,e,i));let t=c=0;for(;c<i.length;c++){const e=n(i[c]);null!=e&&(i[t++]=e)}t<c&&(i.length=t),u=-4097&(20|(u=be(u,a))),q(i,u&=-8193),2&u&&Object.freeze(i)}let l;return 1===r||4===r&&32&u?ye(u)||(t=u,(u|=2)!==t&&q(i,u),Object.freeze(i)):(n=5===r&&(!!(32&u)||ye(u)||!!Ct?.get(i)),(2===r||n)&&ye(u)&&(i=F(i),u=Pe(u=Ie(u,a),a,o),q(i,u),a=me(s,a,e,i)),ye(u)||(e=u,(u=Pe(u,a,o))!==e&&q(i,u)),n?(l=Vt(i),Zt(i,t,!0)):2!==r||o||Ct?.delete(i)),l||i}function ve(t,e,n,r){return t=pe(t,e,n,r),Array.isArray(t)?t:J}function be(t,e){return 0===t&&(t=Ie(t,e)),1|t}function ye(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function we(t,e,n,r){t=t.m;let i=$(t);rt(i),me(t,i,e,("0"===r?0===Number(n):n===r)?void 0:n)}function Se(t){if(D)return t[R]??(t[R]=new Map);if(R in t)return t[R];const e=new Map;return Object.defineProperty(t,R,{value:e}),e}function Ae(t,e,n){var r=Yr;let i=t.get(r);if(null!=i)return i;i=0;for(let t=0;t<r.length;t++){const o=r[t];null!=pe(e,n,o)&&(0!==i&&(n=me(e,n,i)),i=o)}return t.set(r,i),i}function Te(t,e,n){var r=t.m,i=$(r),o=pe(r,i,n,!1);return(e=Mt(o,e,i))!==o&&null!=e&&me(r,i,n,e),null==(r=e)||(t=t.m,2&(i=$(t))||(o=le(r))!==r&&me(t,i,n,r=o)),r}function Ee(t,e,n){return null==n&&(n=void 0),ge(t,e,n)}function Ie(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function Pe(t,e,n){return 32&e&&n||(t&=-33),t}function Oe(t,e,n,r){var i=$(t.m);rt(i);const o=t.m;var s=!!(2&i);const a=s?1:2;d&&=!s,s=ve(o,i,e);var u=H(s),c=s;if(Qt(c,t),2!==a&&1!==a||ne(c,t),!(c=!!(4&u))){var l=s,h=i,f=!!(2&(u=be(u,i)));f&&(h|=2);let t=!f,e=!0,r=0,o=0;for(;r<l.length;r++){const i=Mt(l[r],n,h);if(i instanceof n){if(!f){const n=!!(2&H(i.m));t&&=!n,e&&=n}l[o++]=i}}o<r&&(l.length=o),u|=4,u=e?16|u:-17&u,q(l,u=t?8|u:-9&u),f&&Object.freeze(l)}if(d&&!(8&u||!s.length&&(1===a||4===a&&32&u))){ye(u)?(s=F(s),u=Ie(u,i),i=me(o,i,e,s)):ne(s,t);var d=s;for(l=u,u=0;u<d.length;u++)(h=d[u])!==(f=le(h))&&(d[u]=f);l|=8,l=d.length?-17&l:16|l,q(d,l),u=l}if(1===a||4===a&&32&u)ye(u)||(t=u,(u|=!s.length||16&u&&(!c||32&u)?2:2048)!==t&&q(s,u),Object.freeze(s));else if(c=5===a&&(!!(32&u)||ye(u)||!!Ct?.get(s)),(2===a||c)&&ye(u)&&(s=F(s),u=Pe(u=Ie(u,i),i,!0),q(s,u),i=me(o,i,e,s)),ye(u)||(e=u,(u=Pe(u,i,!0))!==e&&q(s,u)),c){var p=Vt(s);Zt(s,t,!0)}p=p||s,r=null!=r?r:new n,p.push(r),2&H(r.m)?W(p,8):W(p,16)}function Le(t){return t??0}function Ne(t,e){return Le(function(t){if(null==t)return t;if("string"==typeof t){if(!t)return;t=+t}return"number"==typeof t&&Number.isFinite(t)?t>>>0:void 0}(fe(t,e)))}function Ue(t,e,n){we(t,e,Bt(n),0)}function Be(t,e,n){if(null!=n&&"string"!=typeof n)throw Error();we(t,e,n,"")}function xe(t,e,n){{const u=t.m;let c=$(u);if(rt(c),null==n)me(u,c,e);else{n=Rt?.get(n)||n;var r,i=H(n),o=i,s=!!(2&i)||Object.isFrozen(n);if((r=!s)&&((r=void 0===st)||(r=!!a&&void 0!==ot)),he(t,i)){i=21,s&&(n=F(n),o=0,i=Pe(i=Ie(i,c),c,!0));for(let t=0;t<n.length;t++)n[t]=Ut(n[t])}r?(n=F(n),o=0,i=Pe(i=Ie(i,c),c,!0)):s||Zt(n,t),i!==o&&q(n,i),me(u,c,e,n)}}}function ke(t,e,n){if(rt($(t.m)),e=(t=_e(t,e,Dt,2,void 0,!0)).push,"string"!=typeof n)throw Error();e.call(t,n)}function je(t){if("string"==typeof t)return{buffer:T(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===N){O(I);var e=t.i;return{buffer:(null==(e=null==e||E(e)?e:"string"==typeof e?T(e):null)?e:t.i=e)||new Uint8Array(0),C:!0}}if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}var Fe=class{constructor(t,e){this.m=ie(t,e)}toJSON(){return De(this)}C(){return!!(2&H(this.m))}};function De(t){ee(t),t=Yt?t.m:se(t.m,ae,void 0,void 0,!1);{var e=!Yt;let c=t.length;if(c){var n=t[c-1],r=tt(n);r?c--:n=void 0;var i=t;if(r){t:{var o,s=n,a=!1;if(s)for(let t in s)isNaN(+t)?(o??={})[t]=s[t]:(r=s[t],Array.isArray(r)&&(et(r)||Q(r)&&0===r.size)&&(r=null),null==r&&(a=!0),null!=r&&((o??={})[t]=r));if(a||(o=s),o)for(let t in o){a=o;break t}a=null}s=null==a?null!=n:a!==n}for(;c>0&&(null==(o=i[c-1])||et(o)||Q(o)&&0===o.size);c--)var u=!0;(i!==t||s||u)&&(e?(u||s||a)&&(i.length=c):i=Array.prototype.slice.call(i,0,c),a&&i.push(a)),u=i}else u=t}return u}function Me(t){return t?/^\d+$/.test(t)?(Et(t),new Ve(bt,yt)):null:Ce||=new Ve(0,0)}Fe.prototype.L=X,Fe.prototype.toString=function(){try{return Yt=!0,De(this).toString()}finally{Yt=!1}};var Ve=class{constructor(t,e){this.j=t>>>0,this.i=e>>>0}};let Ce;function Re(t){return t?/^-?\d+$/.test(t)?(Et(t),new Ge(bt,yt)):null:ze||=new Ge(0,0)}var Ge=class{constructor(t,e){this.j=t>>>0,this.i=e>>>0}};let ze;function We(t,e,n){for(;n>0||e>127;)t.i.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.i.push(e)}function He(t,e){for(;e>127;)t.i.push(127&e|128),e>>>=7;t.i.push(e)}function $e(t,e){if(e>=0)He(t,e);else{for(let n=0;n<9;n++)t.i.push(127&e|128),e>>=7;t.i.push(1)}}function qe(t,e){0!==e.length&&(t.l.push(e),t.j+=e.length)}function Ke(t,e){return He(t.i,8*e+2),e=t.i.end(),qe(t,e),e.push(t.j),e}function Ye(t,e){var n=e.pop();for(n=t.j+t.i.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.j++;e.push(n),t.j++}function Je(t,e,n){He(t.i,8*e+2),He(t.i,n.length),qe(t,t.i.end()),qe(t,n)}function Xe(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var Ze=Xe(),Qe=Xe(),tn=Xe(),en=Xe(),nn=Xe(),rn=Xe(),on=class{constructor(t,e){this.i=t,t=Ze,this.j=!!t&&e===t||!1}};function sn(t,e,n,r,i){null!=(e=dn(e,r))&&(n=Ke(t,n),i(e,t),Ye(t,n))}const an=new on(sn,Ze),un=new on(sn,Ze);var cn=Symbol(),ln=Symbol();let hn;function fn(t){var e=pn,n=gn,r=t[cn];if(r)return r;(r={}).N=function(t){switch(typeof t){case"boolean":return qt||=[0,void 0,!0];case"number":return t>0?void 0:0===t?Kt||=[0,void 0]:[-t,void 0];case"string":return[0,t];case"object":return t}}(t[0]);var i=t[1];let o=1;i&&i.constructor===Object&&(r.S=i,"function"==typeof(i=t[++o])&&(r.W=!0,hn??=t[o+1],i=t[o+=2]));const s={};for(;i&&Array.isArray(i)&&i.length&&"number"==typeof i[0]&&i[0]>0;){for(var a=0;a<i.length;a++)s[i[a]]=i;i=t[++o]}for(a=1;void 0!==i;){let s;"number"==typeof i&&(a+=i,i=t[++o]);var u=void 0;if(i instanceof on?s=i:(s=an,o--),s?.j){i=t[++o],u=t;var c=o;"function"==typeof i&&(i=i(),u[c]=i),u=i}for(c=a+1,"number"==typeof(i=t[++o])&&i<0&&(c-=i,i=t[++o]);a<c;a++)u?n(r,a,s,u):e(r,a,s)}return t[cn]=r}function dn(t,e){return t instanceof Fe?(ee(t),t.m):Array.isArray(t)?re(t,e,!1):void 0}function pn(t,e,n){t[e]=n.i}function gn(t,e,n,r){let i,o;const s=n.i;t[e]=(t,e,n)=>s(t,e,n,o||=fn(r).N,i||=mn(r))}function mn(t){let e=t[ln];if(!e){const n=fn(t);e=(t,e)=>_n(t,e,n),t[ln]=e}return e}function _n(t,e,n){var r=H(t),i=+!!(512&r)-1,o=t.length,s=512&r?1:0;const a=o+(256&r?-1:0);for(;s<a;s++){const r=t[s];if(null==r)continue;const o=s-i,a=vn(n,o);a&&a(e,r,o)}if(256&r){t=t[o-1];for(const s in t)r=+s,Number.isNaN(r)||null!=(i=t[r])&&(o=vn(n,r))&&o(e,i,r)}}function vn(t,e){var n=t[e];if(n)return n;if((n=t.S)&&(n=n[e])){var r=(n=Array.isArray(n)?n[0]instanceof on?n:[un,n]:[n,void 0])[0].i;if(n=n[1]){const e=mn(n),i=fn(n).N;n=t.W?hn(i,e):(t,n,o)=>r(t,n,o,i,e)}else n=r;return t[e]=n}}var bn,yn=0,wn=yn;if(ct(wn)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(wn))throw Error(String(wn))}else if((bn=ut(wn))&&(bn=!Number.isSafeInteger(wn)),bn)throw Error(String(wn));function Sn(t,e){if(Array.isArray(e)){var n=H(e);if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const n=t(e[r]);null!=n&&(e[i++]=n)}return i<r&&(e.length=i),q(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function An(t,e){return new on(t,e)}function Tn(t,e,n){null!=(e=Ot(e))&&(He(t.i,8*n+5),t=t.i,(n=vt||=new DataView(new ArrayBuffer(8))).setFloat32(0,+e,!0),yt=0,e=bt=n.getUint32(0,!0),t.i.push(e>>>0&255),t.i.push(e>>>8&255),t.i.push(e>>>16&255),t.i.push(e>>>24&255))}function En(t,e,n){null!=(e=xt(e))&&null!=e&&(He(t.i,8*n),$e(t.i,e))}function In(t,e,n){null!=(e=null==e||"boolean"==typeof e?e:"number"==typeof e?!!e:void 0)&&(He(t.i,8*n),t.i.i.push(e?1:0))}function Pn(t,e,n){null!=(e=Dt(e))&&Je(t,n,i(e))}function On(t,e,n,r,i){null!=(e=dn(e,r))&&(n=Ke(t,n),i(e,t),Ye(t,n))}function Ln(t,e,n){null!=(e=xt(e))&&(e=parseInt(e,10),He(t.i,8*n),$e(t.i,e))}ht||(yn=lt(yn)?yn?"1":"0":ct(yn)?yn.trim()||"0":String(yn));var Nn,Un=An(Tn,nn),Bn=An(Tn,nn),xn=An((function(t,e,n){if(e=function(t){if(null==t)return t;var e=typeof t;if("bigint"===e)return String(BigInt.asIntN(64,t));if(Nt(t)){if("string"===e){if(e=Math.trunc(Number(t)),Number.isSafeInteger(e))t=String(e);else if(-1!==(e=t.indexOf("."))&&(t=t.substring(0,e)),!("-"===t[0]?t.length<20||20===t.length&&Number(t.substring(0,7))>-922337:t.length<19||19===t.length&&Number(t.substring(0,6))<922337))if(Et(t),t=bt,2147483648&(e=yt))if(j())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=It(t,e);t="-"+At(n,r)}else t=At(t,e);return t}if("number"===e){if(t=Math.trunc(t),!Number.isSafeInteger(t)){St(t),e=bt;var n=yt;(t=2147483648&n)&&(n=~n>>>0,0==(e=1+~e>>>0)&&(n=n+1>>>0)),e=4294967296*n+(e>>>0),t=t?-e:e}return t}}}(e),null!=e){if("string"==typeof e)Re(e);if(null!=e)switch(He(t.i,8*n),typeof e){case"number":t=t.i,St(e),We(t,bt,yt);break;case"bigint":n=BigInt.asUintN(64,e),n=new Ge(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),We(t.i,n.j,n.i);break;default:n=Re(e),We(t.i,n.j,n.i)}}}),Xe()),kn=An((function(t,e,n){if(null!=(e=Ft(e))){if("string"==typeof e)Me(e);if(null!=e)switch(He(t.i,8*n),typeof e){case"number":t=t.i,St(e),We(t,bt,yt);break;case"bigint":n=BigInt.asUintN(64,e),n=new Ve(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),We(t.i,n.j,n.i);break;default:n=Me(e),We(t.i,n.j,n.i)}}}),Xe()),jn=An(En,en);Nn=new on((function(t,e,n){if(null!=(e=Sn(xt,e))&&e.length){n=Ke(t,n);for(let n=0;n<e.length;n++)$e(t.i,e[n]);Ye(t,n)}}),en);var Fn,Dn=An(En,en),Mn=An(En,en),Vn=An(In,Qe),Cn=An(In,Qe),Rn=An(Pn,tn);Fn=new on((function(t,e,n){if(null!=(e=Sn(Dt,e)))for(let a=0;a<e.length;a++){var r=t,o=n,s=e[a];null!=s&&Je(r,o,i(s))}}),tn);var Gn,zn=An(Pn,tn),Wn=An(Pn,tn),Hn=function(t,e,n=Ze){return new on(e,n)}(0,(function(t,e,n,r,i){if(Array.isArray(e))for(let o=0;o<e.length;o++)On(t,e[o],n,r,i)})),$n=new on(On,Ze),qn=An(Ln,rn);Gn=new on((function(t,e,n){if(null!=(e=Sn(xt,e))&&e.length){n=Ke(t,n);for(let n=0;n<e.length;n++)$e(t.i,e[n]);Ye(t,n)}}),rn);var Kn=An(Ln,rn);function Yn(t){return function(){ee(this);const e=new class{constructor(){this.l=[],this.j=0,this.i=new class{constructor(){this.i=[]}length(){return this.i.length}end(){const t=this.i;return this.i=[],t}}}};_n(this.m,e,fn(t)),qe(e,e.i.end());const n=new Uint8Array(e.j),r=e.l,i=r.length;let o=0;for(let t=0;t<i;t++){const e=r[t];n.set(e,o),o+=e.length}return e.l=[n],n}}function Jn(t,e){if(null!=e)if(Array.isArray(e))ge(t,2,se(e,ae,void 0,void 0,!1));else{if(!("string"==typeof e||e instanceof N||E(e)))throw Error("invalid value in Any.value field: "+e+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");if(null!=e)if("string"==typeof e)e=e?new N(e,I):L();else if(e.constructor!==N){if(!E(e))throw Error();e=e.length?new N(new Uint8Array(e),I):L()}we(t,2,e,L())}}var Xn=class extends Fe{constructor(t){super(t)}},Zn=[0,zn,An((function(t,e,n){if(null!=e){if(e instanceof Fe){const r=e.ca;return void(r&&(e=r(e),null!=e&&Je(t,n,je(e).buffer)))}if(Array.isArray(e))return}null!=(e=null==e||"string"==typeof e||E(e)||e instanceof N?e:void 0)&&Je(t,n,je(e).buffer)}),Xe())];let Qn,tr=globalThis.trustedTypes;function er(t){void 0===Qn&&(Qn=function(){let t=null;if(!tr)return t;try{const e=t=>t;t=tr.createPolicy("goog#html",{createHTML:e,createScript:e,createScriptURL:e})}catch(t){}return t}());var e=Qn;return new class{constructor(t){this.i=t}toString(){return this.i+""}}(e?e.createScriptURL(t):t)}function nr(t,...e){if(0===e.length)return er(t[0]);let n=t[0];for(let r=0;r<e.length;r++)n+=encodeURIComponent(e[r])+t[r+1];return er(n)}var rr={};rr[336783863]=[0,Rn,Vn,-1,jn,[0,[1,2,3,4,5,6,7],$n,[0],$n,[0,Vn,Rn,Vn,qn,-1,Gn,Rn,-1,[0,Vn,-1],qn,Vn,-1],$n,[0,Rn,-2],$n,[0,jn,Vn,1,Vn,-3],$n,[0,jn,qn,Vn,-1,Nn,qn,-1],$n,[0,Rn,-2],$n,[0,Rn,qn]],[0,Rn],Vn,[0,[1,3],[2,4],$n,[0,Nn],-1,$n,[0,Fn],-1,Hn,[0,Rn,-1]],Rn];var ir=class extends Fe{constructor(t){super(t)}},or=[0,xn,-1,Cn,-3,xn,Nn,zn,Dn,xn,-1,Cn,Dn,Cn,-2,zn],sr=class extends Fe{constructor(t){super(t,500)}K(t){return Ee(this,7,t)}},ar=[-1,{}],ur=[0,Rn,1,ar],cr=[0,Rn,Fn,ar];function lr(t,e){Oe(t,1,sr,e)}var hr=class extends Fe{constructor(){super(void 0,500)}K(t){return Ee(this,1001,t)}};hr.prototype.i=Yn([-500,Hn,[-500,zn,-1,Fn,-3,[-2,rr,Vn],Hn,Zn,Dn,-1,ur,cr,Hn,[0,zn,Cn],zn,or,Dn,Fn,987,Fn],4,Hn,[-500,Rn,-1,[-1,{}],998,Rn],Hn,[-500,Rn,Fn,-1,[-2,{},Vn],997,Fn,-1],Dn,Hn,[-500,Rn,Fn,ar,998,Fn],Fn,Dn,ur,cr,Hn,[0,zn,-1,ar],Fn,-2,or,zn,-1,Cn,979,ar,Hn,Zn]);var fr=class extends Fe{constructor(t){super(t)}};let dr;const pr=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function gr(){if(void 0===dr)try{await WebAssembly.instantiate(pr),dr=!0}catch{dr=!1}return dr}async function mr(t,e=nr``){const n=await gr()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var _r=class{};function vr(){var t=navigator;return"undefined"!=typeof OffscreenCanvas&&(!function(t=navigator){return(t=t.userAgent).includes("Safari")&&!t.includes("Chrome")}(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function br(t){if("function"!=typeof importScripts){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise(((t,n)=>{e.addEventListener("load",(()=>{t()}),!1),e.addEventListener("error",(t=>{n(t)}),!1),document.body.appendChild(e)}))}importScripts(t.toString())}_r.forVisionTasks=function(t){return mr("vision",t)},_r.forTextTasks=function(t){return mr("text",t)},_r.forGenAiExperimentalTasks=function(t){return mr("genai_experimental",t)},_r.forGenAiTasks=function(t){return mr("genai",t)},_r.forAudioTasks=function(t){return mr("audio",t)},_r.isSimdSupported=function(){return gr()};function yr(t,e,n){t.o||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.h.stringToNewUTF8(e)),t.h._free(e)}function wr(t,e,n){t.o||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(e.length);for(let n=0;n<e.length;n++)r[n]=t.h.stringToNewUTF8(e[n]);e=t.h._malloc(4*r.length),t.h.HEAPU32.set(r,e>>2),n(e);for(const e of r)t.h._free(e);t.h._free(e)}function Sr(t,e,n){t.h.simpleListeners=t.h.simpleListeners||{},t.h.simpleListeners[e]=n}function Ar(t,e,n){let r=[];t.h.simpleListeners=t.h.simpleListeners||{},t.h.simpleListeners[e]=(t,e,i)=>{e?(n(r,i),r=[]):r.push(t)}}const Tr=(Er=class{constructor(t,e){this.l=!0,this.h=t,this.i=null,this.j=0,this.o="function"==typeof this.h._addIntToInputStream,void 0!==e?this.h.canvas=e:vr()?this.h.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.h.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph((new TextEncoder).encode(t),!1)}setGraph(t,e){const n=t.length,r=this.h._malloc(n);this.h.HEAPU8.set(t,r),e?this.h._changeBinaryGraph(n,r):this.h._changeTextGraph(n,r),this.h._free(r)}configureAudio(t,e,n,r,i){this.h._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),yr(this,r||"input_audio",(r=>{yr(this,i=i||"audio_header",(i=>{this.h._configureAudio(r,i,t,e??0,n)}))}))}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.h._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.h.gpuOriginForWebTexturesIsBottomLeft=t}attachErrorListener(t){this.h.errorListener=t}attachEmptyPacketListener(t,e){this.h.emptyPacketListeners=this.h.emptyPacketListeners||{},this.h.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const o=4*t.length;this.j!==o&&(this.i&&this.h._free(this.i),this.i=this.h._malloc(o),this.j=o),this.h.HEAPF32.set(t,this.i/4),yr(this,r,(t=>{this.h._addAudioToInputStream(this.i,e,n,t,i)}))}addGpuBufferToStream(t,e,n){yr(this,e,(e=>{if(!this.h.canvas)throw Error("No OpenGL canvas configured.");e?this.h._bindTextureToStream(e):this.h._bindTextureToCanvas();const r=this.h.canvas.getContext("webgl2")||this.h.canvas.getContext("webgl");if(!r)throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");this.h.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),this.h.gpuOriginForWebTexturesIsBottomLeft&&r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1);const[i,o]=void 0!==t.videoWidth?[t.videoWidth,t.videoHeight]:void 0!==t.naturalWidth?[t.naturalWidth,t.naturalHeight]:void 0!==t.displayWidth?[t.displayWidth,t.displayHeight]:[t.width,t.height];!this.l||i===this.h.canvas.width&&o===this.h.canvas.height||(this.h.canvas.width=i,this.h.canvas.height=o);const[s,a]=[i,o];this.h._addBoundTextureToStream(e,s,a,n)}))}addBoolToStream(t,e,n){yr(this,e,(e=>{this.h._addBoolToInputStream(t,e,n)}))}addDoubleToStream(t,e,n){yr(this,e,(e=>{this.h._addDoubleToInputStream(t,e,n)}))}addFloatToStream(t,e,n){yr(this,e,(e=>{this.h._addFloatToInputStream(t,e,n)}))}addIntToStream(t,e,n){yr(this,e,(e=>{this.h._addIntToInputStream(t,e,n)}))}addUintToStream(t,e,n){yr(this,e,(e=>{this.h._addUintToInputStream(t,e,n)}))}addStringToStream(t,e,n){yr(this,e,(e=>{yr(this,t,(t=>{this.h._addStringToInputStream(t,e,n)}))}))}addStringRecordToStream(t,e,n){yr(this,e,(e=>{wr(this,Object.keys(t),(r=>{wr(this,Object.values(t),(i=>{this.h._addFlatHashMapToInputStream(r,i,Object.keys(t).length,e,n)}))}))}))}addProtoToStream(t,e,n,r){yr(this,n,(n=>{yr(this,e,(e=>{const i=this.h._malloc(t.length);this.h.HEAPU8.set(t,i),this.h._addProtoToInputStream(i,t.length,e,n,r),this.h._free(i)}))}))}addEmptyPacketToStream(t,e){yr(this,t,(t=>{this.h._addEmptyPacketToInputStream(t,e)}))}addBoolVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const e of t)this.h._addBoolVectorEntry(r,e);this.h._addBoolVectorToInputStream(r,e,n)}))}addDoubleVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const e of t)this.h._addDoubleVectorEntry(r,e);this.h._addDoubleVectorToInputStream(r,e,n)}))}addFloatVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const e of t)this.h._addFloatVectorEntry(r,e);this.h._addFloatVectorToInputStream(r,e,n)}))}addIntVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const e of t)this.h._addIntVectorEntry(r,e);this.h._addIntVectorToInputStream(r,e,n)}))}addUintVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const e of t)this.h._addUintVectorEntry(r,e);this.h._addUintVectorToInputStream(r,e,n)}))}addStringVectorToStream(t,e,n){yr(this,e,(e=>{const r=this.h._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const e of t)yr(this,e,(t=>{this.h._addStringVectorEntry(r,t)}));this.h._addStringVectorToInputStream(r,e,n)}))}addBoolToInputSidePacket(t,e){yr(this,e,(e=>{this.h._addBoolToInputSidePacket(t,e)}))}addDoubleToInputSidePacket(t,e){yr(this,e,(e=>{this.h._addDoubleToInputSidePacket(t,e)}))}addFloatToInputSidePacket(t,e){yr(this,e,(e=>{this.h._addFloatToInputSidePacket(t,e)}))}addIntToInputSidePacket(t,e){yr(this,e,(e=>{this.h._addIntToInputSidePacket(t,e)}))}addUintToInputSidePacket(t,e){yr(this,e,(e=>{this.h._addUintToInputSidePacket(t,e)}))}addStringToInputSidePacket(t,e){yr(this,e,(e=>{yr(this,t,(t=>{this.h._addStringToInputSidePacket(t,e)}))}))}addProtoToInputSidePacket(t,e,n){yr(this,n,(n=>{yr(this,e,(e=>{const r=this.h._malloc(t.length);this.h.HEAPU8.set(t,r),this.h._addProtoToInputSidePacket(r,t.length,e,n),this.h._free(r)}))}))}addBoolVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateBoolVector(t.length);if(!n)throw Error("Unable to allocate new bool vector on heap.");for(const e of t)this.h._addBoolVectorEntry(n,e);this.h._addBoolVectorToInputSidePacket(n,e)}))}addDoubleVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateDoubleVector(t.length);if(!n)throw Error("Unable to allocate new double vector on heap.");for(const e of t)this.h._addDoubleVectorEntry(n,e);this.h._addDoubleVectorToInputSidePacket(n,e)}))}addFloatVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateFloatVector(t.length);if(!n)throw Error("Unable to allocate new float vector on heap.");for(const e of t)this.h._addFloatVectorEntry(n,e);this.h._addFloatVectorToInputSidePacket(n,e)}))}addIntVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateIntVector(t.length);if(!n)throw Error("Unable to allocate new int vector on heap.");for(const e of t)this.h._addIntVectorEntry(n,e);this.h._addIntVectorToInputSidePacket(n,e)}))}addUintVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateUintVector(t.length);if(!n)throw Error("Unable to allocate new unsigned int vector on heap.");for(const e of t)this.h._addUintVectorEntry(n,e);this.h._addUintVectorToInputSidePacket(n,e)}))}addStringVectorToInputSidePacket(t,e){yr(this,e,(e=>{const n=this.h._allocateStringVector(t.length);if(!n)throw Error("Unable to allocate new string vector on heap.");for(const e of t)yr(this,e,(t=>{this.h._addStringVectorEntry(n,t)}));this.h._addStringVectorToInputSidePacket(n,e)}))}attachBoolListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachBoolListener(t)}))}attachBoolVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachBoolVectorListener(t)}))}attachIntListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachIntListener(t)}))}attachIntVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachIntVectorListener(t)}))}attachUintListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachUintListener(t)}))}attachUintVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachUintVectorListener(t)}))}attachDoubleListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachDoubleListener(t)}))}attachDoubleVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachDoubleVectorListener(t)}))}attachFloatListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachFloatListener(t)}))}attachFloatVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachFloatVectorListener(t)}))}attachStringListener(t,e){Sr(this,t,e),yr(this,t,(t=>{this.h._attachStringListener(t)}))}attachStringVectorListener(t,e){Ar(this,t,e),yr(this,t,(t=>{this.h._attachStringVectorListener(t)}))}attachProtoListener(t,e,n){Sr(this,t,e),yr(this,t,(t=>{this.h._attachProtoListener(t,n||!1)}))}attachProtoVectorListener(t,e,n){Ar(this,t,e),yr(this,t,(t=>{this.h._attachProtoVectorListener(t,n||!1)}))}attachAudioListener(t,e,n){this.h._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),Sr(this,t,((t,n)=>{t=new Float32Array(t.buffer,t.byteOffset,t.length/4),e(t,n)})),yr(this,t,(t=>{this.h._attachAudioListener(t,n||!1)}))}finishProcessing(){this.h._waitUntilIdle()}closeGraph(){this.h._closeGraph(),this.h.simpleListeners=void 0,this.h.emptyPacketListeners=void 0}},class extends Er{Y(){this.h._registerModelResourcesGraphService()}});var Er;async function Ir(t,e){const n=await(async(t,e,n)=>{var r=si;if(t&&await br(t),!self.ModuleFactory)throw Error("ModuleFactory not set.");if(e&&(await br(e),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&n&&((t=self.Module).locateFile=n.locateFile,n.mainScriptUrlOrBlob&&(t.mainScriptUrlOrBlob=n.mainScriptUrlOrBlob)),n=await self.ModuleFactory(self.Module||n),self.ModuleFactory=self.Module=void 0,new r(n,null)})(t.wasmLoaderPath,t.assetLoaderPath,{locateFile:e=>e.endsWith(".wasm")?t.wasmBinaryPath.toString():t.assetBinaryPath&&e.endsWith(".data")?t.assetBinaryPath.toString():e});return await n.K(e),n}async function Pr(t,e){return Ir(t,e)}function Or(t){try{const e=t.H.length;if(1===e)throw Error(t.H[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.H.map((t=>t.message)).join(", "))}finally{t.H=[]}}function Lr(t,e){t.G=Math.max(t.G,e)}var Nr=class{constructor(t){this.i=t,this.H=[],this.G=0,this.i.setAutoRenderToScreen(!1)}setGraph(t,e){this.i.attachErrorListener(((t,e)=>{this.H.push(Error(e))})),this.i.Y(),this.i.setGraph(t,e),Or(this)}finishProcessing(){this.i.finishProcessing(),Or(this)}close(){this.i.closeGraph()}};Nr.prototype.close=Nr.prototype.close;var Ur=class extends Fe{constructor(t){super(t)}};function Br(t,e){Ee(t,1,e)}var xr=class extends Fe{constructor(){super()}},kr=[0,Kn,Dn,Bn,-1,jn];function jr(t,e,n,r){if(void 0!==t.data){var i=new Uint8Array(t.data.buffer,e,n);return 1===r&&function(t,e,n){t.i.push([e,n]),t.i.sort(((t,e)=>t[0]-e[0])),e=0;for(const[r,i]of t.i){const t=i;(n=r)<=e&&(e=Math.max(e,n+t))}e===t.length&&(t.data=void 0)}(t,e,n),i}}class Fr{constructor(t){this.i=[],this.data=t,this.length=t.length}}var Dr=class{constructor(t,e,n){this.i=t,this.j=e,this.l=n}get size(){let t=0;for(let e=0;e<this.i.length;e++)t+=this.i[e].length;return t}};function Mr(t){if(t.i)try{t.h._free(t.j)}catch{}finally{t.i=!1}}var Vr=class{constructor(t,e){this.h=t,this.l=e,this.j=this.h._malloc(e)>>>0,this.o=this.h.HEAPU8,this.i=!!this.j}get offset(){if(!this.i)throw Error("WasmFileReference has been freed.");return this.j}get size(){if(!this.i)throw Error("WasmFileReference has been freed.");return this.l}set(t,e){this.o.set(t,this.j+(e??0))}},Cr=class extends Fe{constructor(){super()}};Cr.prototype.i=Yn([0,zn,2,Fn,Dn,Cn]);var Rr=class extends Fe{constructor(){super()}},Gr=class extends Fe{constructor(){super()}},zr=class extends Fe{constructor(){super()}},Wr=class extends Fe{constructor(){super()}},Hr=[0,Dn,-6,1,Dn,1,[0,Cn,Kn,-2],[0,Cn,Bn],Kn,-2,[0,Cn,-1,Kn,Bn,qn,jn],1,Cn,Dn,jn,-1,[0,Kn,Dn],Cn,-1,Un,Dn],$r=[0,[4,6],Hr,Dn,1,Mn,Fn,Wn,Gn,[0,zn,-2],jn,[0,[0,Dn,-1,Hn,[0,Dn,[0,Dn,-1],-1,[0,Kn,-1],Cn],Cn,-2,Dn,-1],[0,Dn,-1,Cn],Hr,Cn,Dn],Rn,-3,[0,Dn,Cn]];Wr.prototype.i=Yn([0,zn,8,[0,Cn,-6],1,Dn,1,Dn,[0,Hn,[0,zn,kn,-1,Kn],$r,Dn],[0,Dn,Cn,-3],1,Kn,1,$r,1,Dn,5,Kn,Nn,1,kr]);var qr=class extends Fe{constructor(){super()}},Kr=class extends Fe{constructor(){super()}},Yr=[2,4];Kr.prototype.i=Yn([0,Yr,Dn,Wn,Dn,$n,[0,1,zn]]);const Jr=function(t){return class e extends t{static async Z(t,n){let r;n||=await e.O();const i=[];for(const e of t?.requiredFeatures??[])n.features.has(e)?i.push(e):console.warn(`WebGPU feature ${e} is not supported.`);t={...t,requiredFeatures:i};try{r=await n.requestDevice(t)}catch(t){throw console.error("Unable to initialize WebGPU with the requested features."),t}return n=await n.requestAdapterInfo(),r.adapterInfo=n,r}static async O(t){if(!(t=await navigator.gpu.requestAdapter(t)))throw Error("Unable to request adapter from navigator.gpu; Ensure WebGPU is enabled.");return t}V(t){if(e)"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.id="canvas_webgpu");else var e=new OffscreenCanvas(1,1);e.getContext("webgpu").configure({device:t,format:navigator.gpu.getPreferredCanvasFormat()}),this.h.preinitializedWebGPUDevice=t}R(){return this.h.ccall("closeGraph","void",[],[],{async:!0})}}}(function(t){return class extends t{addStreamingReaderToInputSidePacket(t,e){this.h.addStreamingReaderToInputSidePacket(((e,n,r)=>async function(t,e,n,r,i){if(2===i)return t.i=[],t.j=()=>Promise.resolve(void 0),setTimeout((()=>{t.l()}),0),Promise.resolve(0);for(;t.size<n+r;){var o=await t.j();if(void 0===o)break;t.i.push(new Fr(o))}if(t.size<n+r)throw Error(`Data size is too small: ${t.size}, expected at least ${n+r}.`);o=e._malloc(r)>>>0;let s=0;for(let a=0;a<t.i.length;a++){const u=t.i[a];if(n>=u.length){n-=u.length;continue}const c=Math.min(r,u.length-n);if(void 0===(n=jr(u,n,c,i)))throw Error("Data has already been released.");if(e.HEAPU8.set(n,o+s),n=0,s+=c,0==(r-=c))break}if(0!==r)throw Error("Data not found.");return Promise.resolve(o)}(t,this.h,e,n,r)),e)}}}(function(t){return class extends t{P(t,e){yr(this,"lora_model_ref_in",(n=>{this.h._addRawDataSpanToInputStream(t.offset,t.size,n,e)}))}}}(class extends Tr{})));class Xr extends Jr{}var Zr=class{constructor(t){this.j=t,this.i=Qr,Qr++}},Qr=0;class ti{constructor(){let t,e;this.promise=new Promise(((n,r)=>{t=n,e=r})),this.resolve=t,this.reject=e}}function ei(t){return 1===t?1:t+t%2}async function ni(){const t=await Xr.O({powerPreference:"high-performance"});var e=t.limits.maxBufferSize;if(t.limits.maxStorageBufferBindingSize<524550144)throw Error(`The WebGPU device is unable to execute LLM tasks, because the required maxStorageBufferBindingSize is at least 524550144 but your device only supports maxStorageBufferBindingSize of ${e}`);if(e>=786825216)e=786825216;else{if(!(e>=524550144))throw Error(`The WebGPU device is unable to execute LLM tasks, because the required maxBufferSize is at least 524550144 but your device only supports maxBufferSize of ${e}`);e=524550144}if(e={requiredFeatures:["shader-f16"],requiredLimits:{maxStorageBufferBindingSize:524550144,maxBufferSize:e,maxStorageBuffersPerShaderStage:t.limits.maxStorageBuffersPerShaderStage}},t.features.has("subgroups")){console.warn("Experimental Chromium WGSL subgroup support detected. Enabling this feature in the inference engine.");const n=["shader-f16","subgroups"];t.features.has("subgroups-f16")&&n.push("subgroups-f16"),e.requiredFeatures=n}return Xr.Z(e,t)}function ri(t){const e=function(t){const e=new hr;ke(e,10,"text_in"),ke(e,10,"token_cost_in"),ke(e,10,"lora_model_id_to_apply_in"),ke(e,10,"lora_model_ref_in"),ke(e,10,"lora_model_id_to_load_in"),ke(e,16,"streaming_reader"),ke(e,15,"text_out"),ke(e,15,"text_end"),ke(e,15,"token_cost_out");var n=new sr;Be(n,2,"TokenizerInputBuildCalculator"),ke(n,3,"PROMPT:text_in"),ke(n,3,"LORA_ID:lora_model_id_to_apply_in"),ke(n,4,"prompt"),lr(e,n),Be(n=new sr,2,"ModelDataCalculator"),ke(n,6,"MODEL_DATA:__side_packet_1"),ke(n,6,"MODEL_TYPE:model_type"),ke(n,5,"READ_DATA_FN:streaming_reader"),ke(n,3,"LORA_MODEL_SPAN:lora_model_ref_in"),ke(n,3,"LORA_MODEL_ID:lora_model_id_to_load_in"),ke(n,4,"LORA_DATA:lora_model_data"),lr(e,n),Be(n=new sr,2,"Gpt2UnicodeMappingCalculator"),ke(n,5,"MODEL_TYPE:model_type"),ke(n,6,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),lr(e,n),Be(n=new Xn,1,"type.googleapis.com/odml.infra.proto.TokenizerCalculatorOptions");var r=new Kr,i=Ne(t.j,2);Ue(r,1,i),Be(i=new qr,2,"spm_vocab_model"),null==i&&(i=void 0);t:{var o=r.m,s=$(o);if(rt(s),null==i){var a=Se(o);if(4!==Ae(a,o,s))break t;a.set(Yr,0)}else{const t=Se(a=o),e=Ae(t,a,s);4!==e&&(e&&(s=me(a,s,e)),t.set(Yr,4))}me(o,s,4,i)}return Ue(r,3,2),Jn(n,r.i()),Be(r=new sr,2,"TokenizerCalculator"),Oe(r,8,Xn,n),ke(r,5,"MODEL_DATA:__side_packet_1"),ke(r,3,"PROMPT_AND_INPUT_OPTIONS:prompt"),ke(r,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),ke(r,6,"PROCESSOR_GETTER:__input_side_1"),ke(r,4,"IDS_AND_INPUT_OPTIONS:__stream_0"),lr(e,r),Be(n=new Xn,1,"type.googleapis.com/odml.infra.proto.LlmGpuCalculatorOptions"),Ue(r=new Wr,12,3),Be(r,1,"llm.tflite"),Ue(r,14,0),i=ei(Ne(t.j,5)),Ue(r,22,i),i=Te(t.j,Ur,3),Ee(r,31,i),we(i=new Rr,1,!0,!1),we(i,2,!0,!1),we(i,5,!0,!1),Ee(r,10,i),i=_e(t.j,4,xt,void 0===it?2:5),xe(r,29,i),i=new zr,Ue(o=new Gr,1,1),a=Ne(t.j,2),Ue(o,2,a),Ee(i,1,o),Ee(r,20,i),Jn(n,r.i()),Be(r=new sr,2,"LlmGpuCalculator"),Oe(r,8,Xn,n),ke(r,3,"IDS_AND_INPUT_OPTIONS:__stream_0"),ke(r,3,"FINISH:finish"),ke(r,3,"LORA_DATA:lora_model_data"),ke(r,5,"MODEL_DATA:__side_packet_1"),ke(r,4,"DECODED_IDS:__stream_3"),ke(r,4,"OUTPUT_END:__stream_4"),Be(n=new ir,1,"FINISH"),we(n,2,!0,!1),Oe(r,13,ir,n),lr(e,r),Be(n=new sr,2,"IsPacketPresentCalculator"),ke(n,3,"__stream_4"),ke(n,4,"text_end"),lr(e,n),Be(n=new Xn,1,"type.googleapis.com/odml.infra.proto.DetokenizerCalculatorOptions"),r=new Cr,t=ei(Ne(t.j,5)),Ue(r,5,t),ke(r,4,"<eos>"),ke(r,4,"<|endoftext|>"),Jn(n,r.i()),Be(t=new sr,2,"DetokenizerCalculator"),Oe(t,8,Xn,n),ke(t,3,"IDS_AND_INPUT_OPTIONS:__stream_3"),ke(t,5,"PROCESSOR_GETTER:__input_side_1"),ke(t,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),ke(t,5,"MODEL_DATA:__side_packet_1"),ke(t,4,"FINISH_AND_INPUT_OPTIONS:finish"),ke(t,4,"WORDS:text_out"),lr(e,t),Be(t=new sr,2,"TokenCostCalculator"),ke(t,3,"PROMPT:token_cost_in"),ke(t,5,"PROCESSOR_GETTER:__input_side_1"),ke(t,5,"BYTES_TO_UNICODE_MAPPING:tokenizer_mapping"),ke(t,4,"NUM_TOKENS:token_cost_out"),lr(e,t),e}(t);t.i.attachStringVectorListener("text_out",((e,n)=>{e=function(t,e){return null==t||0===t.length?[]:t.map((t=>(t=(t=t.replaceAll("▁"," ")).replaceAll("<0x0A>","\n"),e&&(t=t.trimStart()),t.split("\\[eod\\]",1)[0])))}(e,0===t.D.length),e.forEach(((e,n)=>{n<Ne(t.j,5)&&t.D[n].push(e)})),t.A&&0===t.B.length&&(t.F?(e.length>Ne(t.j,5)&&e.pop(),t.A(e,!1)):t.A(e[0],!1)),Lr(t,n)})),t.i.attachEmptyPacketListener("text_out",(e=>{Lr(t,e)})),t.i.attachBoolListener("text_end",((e,n)=>{if(t.l=!1,Lr(t,n),ii(t),t.o&&(t.o.resolve(t.D.map((t=>t.join("")))),t.o=void 0),t.A)if(t.F){for(e=[],n=0;n<Ne(t.j,5);n++)e.push("");t.A(e,!0)}else t.A("",!0);t.F=void 0})),t.i.attachEmptyPacketListener("text_end",(e=>{t.l=!1,t.F=void 0,Lr(t,e),ii(t),t.o&&(t.o.resolve(t.D.map((t=>t.join("")))),t.o=void 0)})),t.i.attachIntListener("token_cost_out",((e,n)=>{t.M=e,Lr(t,n)})),t.J&&t.i.addStreamingReaderToInputSidePacket(t.J,"streaming_reader");const n=e.i();return t.v?.removeEventListener("uncapturederror",t.I),t.i.R().then((()=>{t.v?.addEventListener("uncapturederror",t.I),t.B.length=0,t.setGraph(new Uint8Array(n),!0),t.finishProcessing()}))}function ii(t){if(t.B.length>0){const e=[...t.B];if(t.B.length=0,!t.o)throw e;t.o.reject(e),t.o=void 0}}function oi(t,e,n,r){if(t.l)throw Error("Previous invocation or loading is still ongoing.");for(t.A="function"==typeof n?n:r,t.l=!0,t.D.length=0,r=0;r<Ne(t.j,5);r++)t.D[r]=[];if(r=t.G+1,t.i.addStringToStream(e,"text_in",r),n instanceof Zr){if(n.j!==t)throw t.l=!1,t.F=void 0,Error("The LoRA model was not loaded by this LLM Inference task.");t.i.addUintToStream(n.i,"lora_model_id_to_apply_in",r)}else t.i.addEmptyPacketToStream("lora_model_id_to_apply_in",r);return t.finishProcessing(),t.o=new ti,t.o.promise}var si=class extends Nr{constructor(t,e){super(new Xr(t,e)),this.D=[],this.l=!1,this.B=[],this.I=t=>{const e=(t=t.error).message.match(/exceeds the max buffer size limit \(([0-9]+)\)\./);e&&Number(e[1])>524550144?t=Error(`Failed to run this LLM model, but you could try a smaller LLM model. WebGPU throws: "${t.message}"`):t.message.match(/is larger than the maximum binding size/)&&(t=Error(`Failed to run LLM inference, the supported max binding size is smaller than the required size. WebGPU throws: "${t.message}"`)),this.B.push(t)},this.j=new xr,Br(this.j,new fr),this.u=new Ur,Ee(this.j,3,this.u),ge(this.j,2,kt(512)),we(this.u,1,2,0),Ue(this.u,2,40),we(this.u,3,Pt(1),0),ge(this.u,5,Bt(0)),we(this.u,4,Pt(.8),0),ge(this.j,5,kt(1))}K(t){if(this.l)throw Error("Cannot set options while loading or processing.");if(this.l=!0,t.baseOptions?.gpuOptions?.device&&(this.v&&this.v.removeEventListener("uncapturederror",this.I),this.v=t.baseOptions.gpuOptions.device,this.i.V(this.v),this.v.addEventListener("uncapturederror",this.I)),"maxTokens"in t&&ge(this.j,2,kt(t.maxTokens??512)),"topK"in t&&Ue(this.u,2,t.topK??40),"temperature"in t&&we(this.u,4,Pt(t.temperature??.8),0),"randomSeed"in t&&ge(this.u,5,Bt(t.randomSeed??0)),"loraRanks"in t&&function(t,e){xe(t,4,e)}(this.j,t.loraRanks??[]),"numResponses"in t){var e=t.numResponses??1;if(e<1)throw Error("'numResponses' must be at least 1.");ge(this.j,5,kt(e));var n=Te(this.j,Ur,3);e>1&&n&&(Le(xt(fe(n,2)))<=1||Le(function(t){t=t.m;let e=$(t);const n=pe(t,e,4),r=Ot(n);return null!=r&&r!==n&&me(t,e,4,r),r}(n))<=0)&&console.warn("To generate multiple responses, it is expected topK > 1 and temperature > 0; otherwise, all the generated responses may be the same.")}let r;if(e=new Promise((t=>{r=t})),t.baseOptions?.modelAssetPath||t.baseOptions?.modelAssetBuffer){if(t.baseOptions.modelAssetPath&&t.baseOptions.modelAssetBuffer)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");n=!1,t.baseOptions.modelAssetPath?this.J=function(t,e){const n=fetch(t.toString()).then((t=>t?.body?.getReader()));return new Dr([],(async()=>{let e;try{e=await n}catch(e){throw Error(`Error loading model from "${t.toString()}": ${e}`)}const{value:r,done:i}=await e.read();return i?void 0:r}),e)}(t.baseOptions.modelAssetPath,r):t.baseOptions.modelAssetBuffer instanceof Uint8Array?(this.J=function(t,e){return new Dr([new Fr(t)],(()=>Promise.resolve(void 0)),e)}(t.baseOptions.modelAssetBuffer,r),n=!0):t.baseOptions.modelAssetBuffer?(this.J=function(t,e){return new Dr([],(async()=>{const{value:e,done:n}=await t.read();return n?void 0:e}),e)}(t.baseOptions.modelAssetBuffer,r),n=!0):r(),n&&(t.baseOptions.modelAssetBuffer=void 0)}return t=ri(this).then((()=>{})),Promise.all([e,t]).then((()=>{this.l=!1,ii(this)}))}get baseOptions(){return Te(this.j,fr,1)}set baseOptions(t){Br(this.j,t)}T(t,e,n){return Ne(this.j,5)>1&&console.warn("'numResponses' is set larger than 1 and this function only returns the first response, so we recommend either using 'generateResponses()' to obtain multiple responses, or else setting 'numResponses' to 1 for better performance."),this.F=!1,oi(this,t,e,n).then((t=>t[0]))}U(t,e,n){return this.F=!0,oi(this,t,e,n)}aa(t){if(this.l)throw Error("Previous invocation or loading is still ongoing.");return this.l=!0,this.M=void 0,this.i.addStringToStream(t,"token_cost_in",this.G+1),this.finishProcessing(),this.l=!1,this.M}async X(t){if(this.l)throw Error("Cannot load LoRA model while loading or processing.");if(this.l=!0,t instanceof Uint8Array){var e=new Vr(this.i.h,t.length);e.set(t),t=e}else t=await async function(t,e){var n=await fetch(e.toString());e=Number(n.headers.get("content-length")),t=new Vr(t,e);let r=0;for(n=n?.body?.getReader();;){const{value:e,done:i}=await n.read();if(i)break;t.set(e,r),r+=e.byteLength}if(e!==r)throw Mr(t),Error(`File could not be fully loaded to memory, so was not retained. Loaded ${r}/${e} bytes before failure`);return t}(this.i.h,t);return e=new Zr(this),this.i.P(t,this.G+1),this.i.addUintToStream(e.i,"lora_model_id_to_load_in",this.G+1),this.finishProcessing(),Mr(t),this.l=!1,e}close(){this.v?.removeEventListener("uncapturederror",this.I),super.close()}};si.prototype.loadLoraModel=si.prototype.X,si.prototype.sizeInTokens=si.prototype.aa,si.prototype.generateResponses=si.prototype.U,si.prototype.generateResponse=si.prototype.T,si.prototype.setOptions=si.prototype.K,si.createWebGpuDevice=ni,si.createFromModelPath=async function(t,e){return Pr(t,e={baseOptions:{gpuOptions:{device:await ni()},modelAssetPath:e}})},si.createFromModelBuffer=async function(t,e){return Pr(t,e={baseOptions:{gpuOptions:{device:await ni()},modelAssetBuffer:e}})},si.createFromOptions=async function(t,e){if(!e.baseOptions?.gpuOptions?.device){const t=await ni();e.baseOptions=e.baseOptions??{},e.baseOptions.gpuOptions=e?.baseOptions?.gpuOptions??{},e.baseOptions.gpuOptions.device=t}return Pr(t,e)};export{_r as FilesetResolver,si as LlmInference,Nr as TaskRunner};
//# sourceMappingURL=genai_bundle_mjs.js.map
